<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Mini Mario Levels</title>
<style>
body {
    margin: 0;
    background: #87ceeb;
}
canvas {
    display: block;
    margin: auto;
    background: #87ceeb;
}
</style>
</head>
<body>

<canvas id="game" width="900" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ========= PLAYER ========= */
let player = {
    x: 50,
    y: 300,
    w: 30,
    h: 40,
    speed: 4,
    dy: 0,
    gravity: 0.8,
    jump: 14,
    grounded: false
};

/* ========= LEVEL DATA ========= */
const levels = [
    {
        platforms: [
            {x:0,y:350,w:900,h:50},
            {x:200,y:280,w:100,h:20},
            {x:400,y:230,w:100,h:20}
        ],
        enemies: [
            {x:300,y:320,w:30,h:30,dir:1}
        ]
    },
    {
        platforms: [
            {x:0,y:350,w:900,h:50},
            {x:150,y:300,w:120,h:20},
            {x:350,y:250,w:120,h:20},
            {x:550,y:200,w:120,h:20}
        ],
        enemies: [
            {x:200,y:320,w:30,h:30,dir:1},
            {x:500,y:320,w:30,h:30,dir:-1}
        ]
    },
    {
        platforms: [
            {x:0,y:350,w:900,h:50},
            {x:250,y:280,w:150,h:20},
            {x:500,y:220,w:150,h:20}
        ],
        enemies: [
            {x:300,y:320,w:30,h:30,dir:1},
            {x:600,y:320,w:30,h:30,dir:-1},
            {x:520,y:190,w:30,h:30,dir:1}
        ]
    }
];

let levelIndex = 0;
let platforms = [];
let enemies = [];

/* ========= INPUT ========= */
let keys = {};
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

/* ========= LOAD LEVEL ========= */
function loadLevel() {
    platforms = JSON.parse(JSON.stringify(levels[levelIndex].platforms));
    enemies = JSON.parse(JSON.stringify(levels[levelIndex].enemies));
    player.x = 50;
    player.y = 200;
}
loadLevel();

/* ========= UPDATE ========= */
function update() {

    // Gerak
    if (keys["ArrowRight"]) player.x += player.speed;
    if (keys["ArrowLeft"]) player.x -= player.speed;

    // Lompat
    if (keys["Space"] && player.grounded) {
        player.dy = -player.jump;
        player.grounded = false;
    }

    // Gravitasi
    player.dy += player.gravity;
    player.y += player.dy;
    player.grounded = false;

    // Platform collision
    platforms.forEach(p => {
        if (
            player.x < p.x + p.w &&
            player.x + player.w > p.x &&
            player.y + player.h < p.y + 15 &&
            player.y + player.h + player.dy >= p.y
        ) {
            player.y = p.y - player.h;
            player.dy = 0;
            player.grounded = true;
        }
    });

    // Enemy movement
    enemies.forEach(e => {
        e.x += e.dir * 2;
        if (e.x < 0 || e.x + e.w > canvas.width) e.dir *= -1;

        // Collision with player
        if (
            player.x < e.x + e.w &&
            player.x + player.w > e.x &&
            player.y < e.y + e.h &&
            player.y + player.h > e.y
        ) {
            // Lompat di atas musuh
            if (player.dy > 0) {
                enemies.splice(enemies.indexOf(e), 1);
                player.dy = -8;
            } else {
                alert("Game Over!");
                levelIndex = 0;
                loadLevel();
            }
        }
    });

    // Batas
    if (player.x < 0) player.x = 0;
    if (player.x + player.w > canvas.width)
        player.x = canvas.width - player.w;

    // Jatuh
    if (player.y > canvas.height) {
        alert("Jatuh! Game Over");
        levelIndex = 0;
        loadLevel();
    }

    // Next level
    if (player.x > canvas.width - 40) {
        levelIndex++;
        if (levelIndex >= levels.length) {
            alert("SELAMAT! TAMAT ðŸŽ‰");
            levelIndex = 0;
        }
        loadLevel();
    }
}

/* ========= DRAW ========= */
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Platforms
    ctx.fillStyle = "#654321";
    platforms.forEach(p => ctx.fillRect(p.x,p.y,p.w,p.h));

    // Player
    ctx.fillStyle = "red";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    // Enemies
    ctx.fillStyle = "green";
    enemies.forEach(e => ctx.fillRect(e.x,e.y,e.w,e.h));

    // UI
    ctx.fillStyle = "black";
    ctx.font = "16px Arial";
    ctx.fillText("Level: " + (levelIndex+1), 10, 20);
}

/* ========= LOOP ========= */
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
